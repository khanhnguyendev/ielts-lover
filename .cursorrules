# IELTS Lover - AI Coding Standards

## Project Context
AI-powered IELTS preparation platform using Next.js 16, Supabase, and a strict layered architecture.

## Architectural Layers
- **UI (app/)**: Render only. Call Server Actions. No DB/AI logic.
- **Service (services/)**: Business logic center. Subscription rules, AI orchestration, scoring.
- **Repository (repositories/)**: Data persistence. Pure SQL/Supabase queries.

## Rule Enforcement (CRITICAL)
1. **Strict Layering**: No DB queries in UI. No AI calls in Repositories.
2. **Service Mandatory**: If business logic exists outside services/ ‚Üí REJECT.
3. **AI Protocol**:
   - Treatment: Fallible, asynchronous, expensive.
   - Prompts: Versioned JSON-return prompts in `ai.service.ts`.
   - Storage: Every AI response must be stored in `reports` table.
4. **Immutability**:
   - `exercises` are versioned/immutable once published.
   - `attempts` and `reports` are historical records; never edit.
5. **Subscription**:
   - Only `subscription.policy.ts` decides access.
   - UI shows "Upgrade" UI based on explicit policy failure reasons.

## Stack Conventions
- **Next.js**: Use App Router, Server Components where possible.
- **Naming**: Standardize all component files to **kebab-case** (e.g., `user-profile-menu.tsx`).
- **Tailwind**: Mobile-first, strict adhering to the purple/minimalist design system.
- **Shadcn UI**: Base components only; customize in `components/ui`.
- **Zustand**: For ephemeral UI state (e.g., sidebar toggles, active practice state).

## üå≤ GIT COMMIT CONVENTION (STRICT)

When I ask you to generate a git commit message or execute a commit, you **MUST** strictly follow the **Conventional Commits** standard with the following format:

`<type>(<scope>): <emoji> <subject>`

### 1. Allowed Types & Emojis
| Type | Emoji | Usage |
| :--- | :--- | :--- |
| **feat** | ‚ú® | New feature or functionality |
| **fix** | üêõ | Bug fix |
| **ui** | üíÑ | CSS, styling, visual changes (no logic change) |
| **refactor** | ‚ôªÔ∏è | Code restructuring without behavioral change |
| **perf** | ‚ö°Ô∏è | Performance improvements |
| **docs** | üìö | Documentation updates (README, comments) |
| **test** | ‚úÖ | Adding or fixing tests |
| **chore** | üîß | Build, config, dependencies, tooling |
| **wip** | üöß | Work in progress (intermediate commit) |

### 2. Formatting Rules
- **Scope**: Optional but recommended (e.g., `auth`, `header`, `api`). Use lowercase.
- **Subject**:
  - Use **imperative mood** ("add" not "added", "fix" not "fixed").
  - No trailing period (.).
  - Max 50-70 characters.
  - Must be lowercase.

### 3. Examples
‚úÖ **Good:**
- `feat(auth): ‚ú® add google login provider`
- `fix(navbar): üêõ resolve layout shift on mobile`
- `ui(dashboard): üíÑ update card shadow and spacing`
- `chore(deps): üîß upgrade next.js to v14`

‚ùå **Bad:**
- `Added login` (No type)
- `feat: fixed the bug` (Past tense, wrong type)
- `Update styles.` (Capitalized, period at end)

### 4. Workflow
1. Analyze the staged changes (`git diff --staged`).
2. Determine the most appropriate `type` and `scope`.
3. Generate the commit message strictly following the format above.

## ‚ôªÔ∏è DRY & REUSABILITY (STRICT)

**Core Principle:** Code duplication is a system failure. Always prioritize reusing and refactoring over creating new files.

### 1. The "Audit First" Rule
Before generating any new component or utility function:
-   **SCAN:** Check `@components/ui`, `@components/shared`, and `@lib/utils` to see if a similar solution already exists.
-   **EVALUATE:** If an existing component is an 80% match, you must **REFACTOR** it (add props, variants, or slots) instead of creating a new one.

### 2. Implementation Guidelines
-   ‚ùå **FORBIDDEN:** Creating files like `Button2.tsx`, `CustomInput.tsx`, or `CardNew.tsx` when `Button.tsx`, `Input.tsx`, and `Card.tsx` already exist.
-   ‚úÖ **ALLOWED:**
    -   **Extend:** Add a new `variant` (via `cva` or props) to the existing component.
    -   **Wrap:** Create a wrapper component if the logic is complex, but it must strictly render the base component internally.
    -   **Abstract:** If you find yourself writing the same logic in 2 places, extract it immediately into a custom hook (`/hooks`) or utility function (`/lib`).

### 3. UI Primitives
-   Always build upon the existing Design System (e.g., Shadcn UI primitives).
-   Do not hardcode styles (e.g., `<div className="bg-red-500 rounded-md p-4">`) if a `<Alert variant="destructive">` component exists.

### 4. Verification
-   If you must create a new component that looks similar to an old one, you must **justify** why the old one cannot be extended in the code comments or commit message.