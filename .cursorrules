# IELTS Lover - AI Coding Standards

## Project Context
AI-powered IELTS preparation platform using Next.js 16, Supabase, and a strict layered architecture.

## Architectural Layers
- **UI (app/)**: Render only. Call Server Actions. No DB/AI logic.
- **Service (services/)**: Business logic center. Subscription rules, AI orchestration, scoring.
- **Repository (repositories/)**: Data persistence. Pure SQL/Supabase queries.

## Rule Enforcement (CRITICAL)
1. **Strict Layering**: No DB queries in UI. No AI calls in Repositories.
2. **Service Mandatory**: If business logic exists outside services/ â†’ REJECT.
3. **AI Protocol**:
   - Treatment: Fallible, asynchronous, expensive.
   - Prompts: Versioned JSON-return prompts in `ai.service.ts`.
   - Storage: Every AI response must be stored in `reports` table.
4. **Immutability**:
   - `exercises` are versioned/immutable once published.
   - `attempts` and `reports` are historical records; never edit.
5. **Subscription**:
   - Only `subscription.policy.ts` decides access.
   - UI shows "Upgrade" UI based on explicit policy failure reasons.

## Stack Conventions
- **Next.js**: Use App Router, Server Components where possible.
- **Tailwind**: Mobile-first, strict adhering to the purple/minimalist design system.
- **Shadcn UI**: Base components only; customize in `components/ui`.
- **Zustand**: For ephemeral UI state (e.g., sidebar toggles, active practice state).

## ğŸŒ² GIT COMMIT CONVENTION (STRICT)

When I ask you to generate a git commit message or execute a commit, you **MUST** strictly follow the **Conventional Commits** standard with the following format:

`<type>(<scope>): <emoji> <subject>`

### 1. Allowed Types & Emojis
| Type | Emoji | Usage |
| :--- | :--- | :--- |
| **feat** | âœ¨ | New feature or functionality |
| **fix** | ğŸ› | Bug fix |
| **ui** | ğŸ’„ | CSS, styling, visual changes (no logic change) |
| **refactor** | â™»ï¸ | Code restructuring without behavioral change |
| **perf** | âš¡ï¸ | Performance improvements |
| **docs** | ğŸ“š | Documentation updates (README, comments) |
| **test** | âœ… | Adding or fixing tests |
| **chore** | ğŸ”§ | Build, config, dependencies, tooling |
| **wip** | ğŸš§ | Work in progress (intermediate commit) |

### 2. Formatting Rules
- **Scope**: Optional but recommended (e.g., `auth`, `header`, `api`). Use lowercase.
- **Subject**:
  - Use **imperative mood** ("add" not "added", "fix" not "fixed").
  - No trailing period (.).
  - Max 50-70 characters.
  - Must be lowercase.

### 3. Examples
âœ… **Good:**
- `feat(auth): âœ¨ add google login provider`
- `fix(navbar): ğŸ› resolve layout shift on mobile`
- `ui(dashboard): ğŸ’„ update card shadow and spacing`
- `chore(deps): ğŸ”§ upgrade next.js to v14`

âŒ **Bad:**
- `Added login` (No type)
- `feat: fixed the bug` (Past tense, wrong type)
- `Update styles.` (Capitalized, period at end)

### 4. Workflow
1. Analyze the staged changes (`git diff --staged`).
2. Determine the most appropriate `type` and `scope`.
3. Generate the commit message strictly following the format above.